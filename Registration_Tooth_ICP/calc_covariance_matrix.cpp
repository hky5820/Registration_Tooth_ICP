#include "calc_covariance_matrix.h"

float calc_matrix_element(vector<float> &param1, vector<float> &param2, int num_of_triangle, float avg1, float avg2) {

	float value_matrix_elemnent;
	float sum = 0;

	for (int i = 0; i < num_of_triangle * 3; i++) {
		sum += (param1[i] - avg1) * (param2[i] - avg2);
	}

	return value_matrix_elemnent = sum / (num_of_triangle * 3);
}

void calc_covariance_matrix(STLINFO & info_jaw, Matrix3f &result)
{
	float mat_element_xx, mat_element_yy, mat_element_zz;
	float mat_element_xy, mat_element_xz, mat_element_yz;
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	mat_element_xx = calc_matrix_element(info_jaw.X, info_jaw.X, info_jaw.num_of_triangle, info_jaw.average_xyz.x, info_jaw.average_xyz.x);
	mat_element_yy = calc_matrix_element(info_jaw.Y, info_jaw.Y, info_jaw.num_of_triangle, info_jaw.average_xyz.y, info_jaw.average_xyz.y);
	mat_element_zz = calc_matrix_element(info_jaw.Z, info_jaw.Z, info_jaw.num_of_triangle, info_jaw.average_xyz.z, info_jaw.average_xyz.z);

	mat_element_xy = calc_matrix_element(info_jaw.X, info_jaw.Y, info_jaw.num_of_triangle, info_jaw.average_xyz.x, info_jaw.average_xyz.y);
	mat_element_xz = calc_matrix_element(info_jaw.X, info_jaw.Z, info_jaw.num_of_triangle, info_jaw.average_xyz.x, info_jaw.average_xyz.z);
	mat_element_yz = calc_matrix_element(info_jaw.Y, info_jaw.Z, info_jaw.num_of_triangle, info_jaw.average_xyz.y, info_jaw.average_xyz.z);

	result(0, 0) = mat_element_xx; result(0, 1) = mat_element_xy; result(0, 2) = mat_element_xz;
	result(1, 0) = mat_element_xy; result(1, 1) = mat_element_yy; result(1, 2) = mat_element_yz;
	result(2, 0) = mat_element_xz; result(2, 1) = mat_element_yz; result(2, 2) = mat_element_zz;
}